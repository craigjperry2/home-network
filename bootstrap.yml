---

# Bootstrapping examples:
#
#   Bootstrap this host:
#       [me@this-host ~]$ ansible-playbook --connection=local --inventory-file=localhost, playbooks/bootstrap.yml
#     OR
#       [root@this-host ~]$ ansible-playbook --connection=local --inventory-file=localhost, playbooks/bootstrap.yml
#
#   Use SSH to bootstrap a remote "r1.local" host (requires your pubkey
#   to be in the remote authorized_keys file):
#       [me@another-host ~]$ ansible-playbook --inventory-file=r1.local, playbooks/bootstrap.yml
#
#   Use SSH, with no trusted keypair to bootstrap a remote "s5.local" host:
#       [me@another-host ~]$ ansible-playbook --inventory-file=s5.local, --ask-pass playbooks/bootstrap.yml
#

- hosts: all
  tasks:
    - group_by: key=user_{{ ansible_user_id }}
      changed_when: False

# root user, create ansible user and install ansible-pull cronjob.
- hosts: user_root
  become: no
  roles:
    - install_ansible_pull
    - install_ansible_galaxy
    - install_ansible

# Non-root, create ansible user
- hosts: '!user_root'
  become: yes
  become_user: root
  roles:
    - install_ansible_pull

# Non-root, install dependency galaxy modules in ansible account
- hosts: '!user_root'
  become: yes
  become_user: ansible
  roles:
    - install_ansible_galaxy

# Non-root, install ansible packages
- hosts: '!user_root'
  become: yes
  become_user: root
  roles:
    - install_ansible

